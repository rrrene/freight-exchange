<%
  @data = []
  @labels = []
  (1..7).each do |index|
    from_time = Time.new - index.days
    to_time = from_time + 1.day
    @labels << from_time.to_i
    @data << ActionRecording.where(['created_at > ? AND created_at < ?', from_time, to_time]).count
  end
%>
<%= google_chart_tag :type => :bar, :size => "660x100", :data => @data, :labels => @labels %>

<%= javascript_tag <<-JAVASCRIPT
      var pollTimestamp = #{@action_recordings.first.created_at.to_i};
      function pollServer() {
        jQuery.ajax({
          url: '#{admin_action_recordings_path}',
          data: 'timestamp='+pollTimestamp,
          dataType: 'html',
          type: 'GET',
          success: function (data, status, xhr) {
            document.title = data;
          }
        });
      }
    JAVASCRIPT
%>

<input type="button" onclick="pollServer();" value="Poll server">

<%= render_partial :recordings, :locals => {:recordings => @action_recordings} %>